From: Mike Hommey <mh+mozilla@glandium.org>
Date: Tue, 5 May 2020 11:28:54 +0000
Subject: Bug 1634926 - Don't depend on in-tree NSS/NSPR when building against
 system NSS/NSPR. r=froydnj

Differential Revision: https://phabricator.services.mozilla.com/D73796
---
 config/recurse.mk | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/config/recurse.mk b/config/recurse.mk
index 38b3364078c..3dc5b7eb164 100644
--- a/config/recurse.mk
+++ b/config/recurse.mk
@@ -207,10 +207,17 @@ toolkit/library/target: widget/gtk/mozgtk/gtk3/target
 endif
 
 ifeq (,$(filter WINNT Darwin Android,$(OS_TARGET)))
-netwerk/test/http3server/target: security/nss/lib/nss/nss_nss3/target security/nss/lib/ssl/ssl_ssl3/target config/external/nspr/pr/target
+ifndef MOZ_SYSTEM_NSS
+netwerk/test/http3server/target: security/nss/lib/nss/nss_nss3/target security/nss/lib/ssl/ssl_ssl3/target
+endif
+ifndef MOZ_SYSTEM_NSPR
+netwerk/test/http3server/target: config/external/nspr/pr/target
+endif
 else
+ifndef MOZ_SYSTEM_NSS
 netwerk/test/http3server/target: security/target
 endif
+endif
 
 # Most things are built during compile (target/host), but some things happen during export
 # Those need to depend on config/export for system wrappers.
