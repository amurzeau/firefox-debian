From: Heiher <r@hev.cc>
Date: Tue, 7 Jun 2016 10:25:45 +0800
Subject: Bug 1277478 - OdinMonkey: MIPS: Fix nop-jump patching code. r=luke

---
 js/src/jit/mips-shared/MacroAssembler-mips-shared.cpp | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/js/src/jit/mips-shared/MacroAssembler-mips-shared.cpp b/js/src/jit/mips-shared/MacroAssembler-mips-shared.cpp
index 8179105..0ad1eb9 100644
--- a/js/src/jit/mips-shared/MacroAssembler-mips-shared.cpp
+++ b/js/src/jit/mips-shared/MacroAssembler-mips-shared.cpp
@@ -1239,21 +1239,21 @@ CodeOffset
 MacroAssembler::nopPatchableToNearJump()
 {
     CodeOffset offset(currentOffset());
-    masm.nop();
-    masm.nop();
+    as_nop();
+    as_nop();
     return offset;
 }
 
 void
 MacroAssembler::patchNopToNearJump(uint8_t* jump, uint8_t* target)
 {
-    ((InstImm*)jump)->setBOffImm16(BOffImm16(target - jump));
+    new (jump) InstImm(op_beq, zero, zero, BOffImm16(target - jump));
 }
 
 void
 MacroAssembler::patchNearJumpToNop(uint8_t* jump)
 {
-    ((InstImm*)jump)->makeNop();
+    new (jump) InstNOP();
 }
 
 void
